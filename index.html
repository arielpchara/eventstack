<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>stack</title>
	<script src="https://code.jquery.com/jquery-1.11.1.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.7.0/underscore-min.js"></script>
	<script src="eventstack.js"></script>
</head>
<body>
<ol id="logger">
	
</ol>

<script>


	function log(){
		var line = $("<li>").appendTo("#logger");
		_.each(arguments,function(arg){
			$('<span>')
				.append(' ')
				.append( arg )
				.appendTo(line);
		});
	}

(function(){

	var eMain = eventStack('main');



	eMain.push(function(stk,data){
		return true;
	});


	eMain.push(function(stk,data){
		if( data.resposta == 'sim' ){
			log(stk.step,'Ah, beleza.');
			return false;
		}
		return true;
	},{name:'sim',depend:'q'});

	eMain.push(function(stk,data){
		log(stk.step,'Me fale mais sobre isso!');
		return true;
	},{name:'nao',depend:'q'});

	eMain.push(function(stk,data){
		log(stk.step,'fim');
		return true;
	},{name:'split',depend:'q'});

	eMain.push(function(stk,data){
		log(stk.step,'Espera 1s...');
		setTimeout(function(){
			var step = stk.step;
			var sim = $('<a href=#>').append('Você acha que sim?').click(function(){
				stk.next({
					resposta: 'sim'
				},step);
			})
			var nao = $('<a href=#>').append('Você acha que não?').click(function(){
				stk.next({
					resposta: 'nao'
				},step);
			})
			log(stk.step,'A chuva vai para baixo ?',sim,nao);
		},1000);
	},{name:'q',depend:'main'});

	eMain.push(function(stk,data){
		log(stk.step,'go!');
		return true;
	},{name:'main'});

})();



(function(){
	var eMain = eventStack('main');
	$('<button>').append('CLICK').click(function(){
		eMain.run();
	}).appendTo('body');

})();

(function(){
	var eSecond = eventStack('second');
	eSecond.push(function(stk,data){
		l(this)
		log('Outra coisa',this);
		return true;
	});
	eSecond.run();
	
})()

/*
e.prep(function(stk,data){
	l(stk.step);
	return true;
})

e.run({
	name: 'paulo'
});
*/
</script>	

</body>
</html>