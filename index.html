<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>stack</title>
	<script src="https://code.jquery.com/jquery-1.11.1.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.7.0/underscore-min.js"></script>
	<script src="eventstack.js"></script>
</head>
<body>
<ol id="logger">
	
</ol>

<script>


	function log(){
		var line = $("<li>").appendTo("#logger");
		_.each(arguments,function(arg){
			$('<span>')
				.append(' ')
				.append( arg )
				.appendTo(line);
		});
	}

(function(){

	var eMain = eventStack('main');
	var eSecond = eventStack('second');

	eMain.push('/main/q/sim',function(stk,data){
		if( data.resposta == 'sim' ){
			log(stk.step,'Ah, beleza.');
			return false;
		}
		return true;
	});

	eMain.push('/main/q/nao',function(stk,data){
		eSecond.push('second',function(stk,d){
			log('>',data.resposta,  JSON.stringify(d) );
			return true;
		});
		log(stk.step,'Me fale mais sobre isso!');
		return true;
	});

	eMain.push('/main/q/fim',function(stk,data){
		log(stk.step,'fim');
		return true;
	});

	eMain.push('/main/q',function(stk,data){
		log(stk.step,'Espera 1s...');
		$(data).attr('disabled',true);
		setTimeout(function(){
			var step = stk.step;
			var sim = $('<a href=#>').append('Você acha que sim?').click(function(){
				stk.next({
					resposta: 'sim'
				},step);
			})
			var nao = $('<a href=#>').append('Você acha que não?').click(function(){
				stk.next({
					resposta: 'nao'
				},step);
			})
			log(stk.step,'A chuva vai para baixo ?',sim,nao);
		},1000);
	});

	eMain.push('/main',function(stk,data){
		log(stk.step,'go!');
		return true;
	});

})();



(function(){
	var eMain = eventStack('main');
	$('<button>').append('CLICK').click(function(){
		eMain.run(this);
	}).appendTo('body');

})();

(function(){
	var eSecond = eventStack('second');
	var eMain = eventStack('main');
	eSecond.push('second',function(stk,data){
		log('Outra coisa 2º');
		return true;
	});
	eMain.push('segundo',function(){
		var bt = $('<button>').append('btn 2').click(function(){
			eSecond.run({nome:'2ª'});
		});
		var rs = $('<button>').append('cancelar tudo').click(function(){
			$('#logger').empty();
			eMain.push('/cancelado',function(){
				log('ja fui refeito');
				return true;
			})
			eMain.run();
		});
		log(bt,rs)
		return true;
	})
})()

/*
e.prep(function(stk,data){
	l(stk.step);
	return true;
})

e.run({
	name: 'paulo'
});
*/
</script>	

</body>
</html>